{"ast":null,"code":"import _regeneratorRuntime from\"/Users/adamoreilly/Desktop/SP2020/yelp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/adamoreilly/Desktop/SP2020/yelp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/adamoreilly/Desktop/SP2020/yelp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useHistory}from\"react-router-dom\";import\"./App.css\";import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";var CheckoutForm=function CheckoutForm(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),succeeded=_useState2[0],setSucceeded=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];var stripe=useStripe();var elements=useElements();var history=useHistory();useEffect(function(){window.scrollTo(0,0);// Create PaymentIntent as soon as the page loads\n},[]);var cardStyle={style:{base:{color:\"#32325d\",fontFamily:'Arial, sans-serif',fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#32325d\"}},invalid:{color:\"#fa755a\",iconColor:\"#fa755a\"}}};var handleChange=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// Listen for changes in the CardElement\n// and display any errors as the customer types their card details\nsetDisabled(event.empty);setError(event.error?event.error.message:\"\");case 2:case\"end\":return _context.stop();}}},_callee);}));return function handleChange(_x){return _ref.apply(this,arguments);};}();var paymentIntent=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();window.fetch(\"https://productroles.herokuapp.com/create-payment-intent\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({items:[{price:props.price}]})}).then(function(res){return res.json();}).then(function(data){console.log(\"payment intent created\"+data.clientSecret);handleSubmit(data.clientSecret);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function paymentIntent(_x2){return _ref2.apply(this,arguments);};}();var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(clientSecret){var payload;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"confirming payment\");setProcessing(true);_context3.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}});case 4:payload=_context3.sent;if(payload.error){setError(\"Payment failed \".concat(payload.error.message));setProcessing(false);}else{setError(null);setProcessing(false);setSucceeded(true);handleForm();}case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSubmit(_x3){return _ref3.apply(this,arguments);};}();var goHome=function goHome(){history.push(\"/\");};var handleForm=function handleForm(){props.form();};return/*#__PURE__*/React.createElement(\"form\",{id:\"payment-form\",onSubmit:paymentIntent},/*#__PURE__*/React.createElement(CardElement,{id:\"card-element\",options:cardStyle,onChange:handleChange}),/*#__PURE__*/React.createElement(\"div\",{className:succeeded?\"p-4 row justified-content-center result-message hidden\":\"p-4 row justified-content-center result-message\"},/*#__PURE__*/React.createElement(\"button\",{disabled:processing||disabled||succeeded,className:\"col btn btn-primary\"},/*#__PURE__*/React.createElement(\"span\",{id:\"button-text\"},processing?/*#__PURE__*/React.createElement(\"div\",{className:\"spinner\",id:\"spinner\"}):\"Post Job Ad\",\" $\",props.price/1000))),error&&/*#__PURE__*/React.createElement(\"div\",{className:\"card-error\",role:\"alert\"},error),/*#__PURE__*/React.createElement(\"div\",{className:succeeded?\"p-4 justify-content-center result-message\":\"p-4 justify-content-center result-message hidden\"},/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary\",onClick:goHome},\"Home.\")),/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"p\",null,\"Payment succeeded! View your new listing on the Home page!  An order summary will be emailed to you.\"))));};export default CheckoutForm;","map":{"version":3,"sources":["/Users/adamoreilly/Desktop/SP2020/yelp/client/src/components/CheckoutForm.jsx"],"names":["React","useState","useEffect","useHistory","CardElement","useStripe","useElements","CheckoutForm","props","succeeded","setSucceeded","error","setError","processing","setProcessing","disabled","setDisabled","clientSecret","setClientSecret","stripe","elements","history","window","scrollTo","cardStyle","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","handleChange","event","empty","message","paymentIntent","e","preventDefault","fetch","method","headers","body","JSON","stringify","items","price","then","res","json","data","console","log","handleSubmit","confirmCardPayment","payment_method","card","getElement","payload","handleForm","goHome","push","form"],"mappings":"yeAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,MAAO,WAAP,CACA,OACEC,WADF,CAEEC,SAFF,CAGEC,WAHF,KAIO,yBAJP,CAMA,GAAMC,CAAAA,YAAY,CAAE,QAAdA,CAAAA,YAAc,CAACC,KAAD,CAAW,eACKP,QAAQ,CAAC,KAAD,CADb,wCACtBQ,SADsB,eACXC,YADW,8BAEHT,QAAQ,CAAC,IAAD,CAFL,yCAEtBU,KAFsB,eAEfC,QAFe,8BAGOX,QAAQ,CAAC,EAAD,CAHf,yCAGtBY,UAHsB,eAGVC,aAHU,8BAIGb,QAAQ,CAAC,IAAD,CAJX,yCAItBc,QAJsB,eAIZC,WAJY,8BAKWf,QAAQ,CAAC,EAAD,CALnB,0CAKtBgB,YALsB,gBAKRC,eALQ,gBAM7B,GAAMC,CAAAA,MAAM,CAAGd,SAAS,EAAxB,CACA,GAAMe,CAAAA,QAAQ,CAAGd,WAAW,EAA5B,CACA,GAAIe,CAAAA,OAAO,CAAGlB,UAAU,EAAxB,CAEAD,SAAS,CAAC,UAAM,CACdoB,MAAM,CAACC,QAAP,CAAgB,CAAhB,CAAmB,CAAnB,EACA;AAED,CAJQ,CAIN,EAJM,CAAT,CAQA,GAAMC,CAAAA,SAAS,CAAG,CAChBC,KAAK,CAAE,CACLC,IAAI,CAAE,CACJC,KAAK,CAAE,SADH,CAEJC,UAAU,CAAE,mBAFR,CAGJC,aAAa,CAAE,aAHX,CAIJC,QAAQ,CAAE,MAJN,CAKJ,gBAAiB,CACfH,KAAK,CAAE,SADQ,CALb,CADD,CAULI,OAAO,CAAE,CACPJ,KAAK,CAAE,SADA,CAEPK,SAAS,CAAE,SAFJ,CAVJ,CADS,CAAlB,CAiBA,GAAMC,CAAAA,YAAY,0FAAG,iBAAOC,KAAP,kHAEnB;AACA;AACAlB,WAAW,CAACkB,KAAK,CAACC,KAAP,CAAX,CACAvB,QAAQ,CAACsB,KAAK,CAACvB,KAAN,CAAcuB,KAAK,CAACvB,KAAN,CAAYyB,OAA1B,CAAoC,EAArC,CAAR,CALmB,sDAAH,kBAAZH,CAAAA,YAAY,4CAAlB,CAQF,GAAMI,CAAAA,aAAa,2FAAG,kBAAOC,CAAP,sHACpBA,CAAC,CAACC,cAAF,GAEAjB,MAAM,CACDkB,KADL,CACW,0DADX,CACuE,CACjEC,MAAM,CAAE,MADyD,CAEjEC,OAAO,CAAE,CACP,eAAgB,kBADT,CAFwD,CAKjEC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CAACC,KAAK,CAAE,CAAC,CAAEC,KAAK,CAAEvC,KAAK,CAACuC,KAAf,CAAD,CAAR,CAAf,CAL2D,CADvE,EAQKC,IARL,CAQU,SAAAC,GAAG,CAAI,CAEX,MAAOA,CAAAA,GAAG,CAACC,IAAJ,EAAP,CAED,CAZL,EAaKF,IAbL,CAaU,SAAAG,IAAI,CAAI,CACZC,OAAO,CAACC,GAAR,CAAY,yBAAyBF,IAAI,CAAClC,YAA1C,EACAqC,YAAY,CAACH,IAAI,CAAClC,YAAN,CAAZ,CACD,CAhBL,EAHoB,wDAAH,kBAAboB,CAAAA,aAAa,8CAAnB,CAsBE,GAAMiB,CAAAA,YAAY,2FAAG,kBAAOrC,YAAP,kIACnBmC,OAAO,CAACC,GAAR,CAAY,oBAAZ,EACAvC,aAAa,CAAC,IAAD,CAAb,CAFmB,uBAGGK,CAAAA,MAAM,CAACoC,kBAAP,CAA0BtC,YAA1B,CAAwC,CAC5DuC,cAAc,CAAE,CACdC,IAAI,CAAErC,QAAQ,CAACsC,UAAT,CAAoBtD,WAApB,CADQ,CAD4C,CAAxC,CAHH,QAGbuD,OAHa,gBAQnB,GAAIA,OAAO,CAAChD,KAAZ,CAAmB,CACjBC,QAAQ,0BAAmB+C,OAAO,CAAChD,KAAR,CAAcyB,OAAjC,EAAR,CACAtB,aAAa,CAAC,KAAD,CAAb,CACD,CAHD,IAGO,CAELF,QAAQ,CAAC,IAAD,CAAR,CACAE,aAAa,CAAC,KAAD,CAAb,CACAJ,YAAY,CAAC,IAAD,CAAZ,CACAkD,UAAU,GACX,CAjBkB,wDAAH,kBAAZN,CAAAA,YAAY,8CAAlB,CAoBA,GAAMO,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAM,CACnBxC,OAAO,CAACyC,IAAR,CAAa,GAAb,EACD,CAFD,CAGA,GAAMF,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CAEnBpD,KAAK,CAACuD,IAAN,GACL,CAHD,CAIA,mBACE,4BAAM,EAAE,CAAC,cAAT,CAAwB,QAAQ,CAAE1B,aAAlC,eACE,oBAAC,WAAD,EAAa,EAAE,CAAC,cAAhB,CAA+B,OAAO,CAAEb,SAAxC,CAAmD,QAAQ,CAAES,YAA7D,EADF,cAEE,2BAAK,SAAS,CAAExB,SAAS,CAAG,wDAAH,CAA8D,iDAAvF,eAA2I,8BACzI,QAAQ,CAAEI,UAAU,EAAIE,QAAd,EAA0BN,SADqG,CAEzI,SAAS,CAAC,qBAF+H,eAIzI,4BAAM,EAAE,CAAC,aAAT,EACGI,UAAU,cACT,2BAAK,SAAS,CAAC,SAAf,CAAyB,EAAE,CAAC,SAA5B,EADS,CAGT,aAJJ,MAKOL,KAAK,CAACuC,KAAN,CAAY,IALnB,CAJyI,CAA3I,CAFF,CAeGpC,KAAK,eACJ,2BAAK,SAAS,CAAC,YAAf,CAA4B,IAAI,CAAC,OAAjC,EACGA,KADH,CAhBJ,cAqBE,2BAAK,SAAS,CAAEF,SAAS,CAAG,2CAAH,CAAiD,kDAA1E,eACE,2BAAK,KAAK,CAAC,KAAX,eACE,8BAAQ,SAAS,CAAC,iBAAlB,CAAoC,OAAO,CAAEoD,MAA7C,UADF,CADF,cAME,2BAAK,KAAK,CAAC,KAAX,eACA,oIADA,CANF,CArBF,CADF,CAqCD,CAjID,CAmIA,cAAetD,CAAAA,YAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\"\nimport \"./App.css\";\nimport {\n  CardElement,\n  useStripe,\n  useElements\n} from \"@stripe/react-stripe-js\";\n\nconst CheckoutForm= (props) => {\n  const [succeeded, setSucceeded] = useState(false);\n  const [error, setError] = useState(null);\n  const [processing, setProcessing] = useState('');\n  const [disabled, setDisabled] = useState(true);\n  const [clientSecret, setClientSecret] = useState('');\n  const stripe = useStripe();\n  const elements = useElements();\n  let history = useHistory(); \n  \n  useEffect(() => {\n    window.scrollTo(0, 0);\n    // Create PaymentIntent as soon as the page loads\n    \n  }, []);\n\n\n  \n  const cardStyle = {\n    style: {\n      base: {\n        color: \"#32325d\",\n        fontFamily: 'Arial, sans-serif',\n        fontSmoothing: \"antialiased\",\n        fontSize: \"16px\",\n        \"::placeholder\": {\n          color: \"#32325d\"\n        }\n      },\n      invalid: {\n        color: \"#fa755a\",\n        iconColor: \"#fa755a\"\n      }\n    }\n  };\n  const handleChange = async (event) => {\n\n    // Listen for changes in the CardElement\n    // and display any errors as the customer types their card details\n    setDisabled(event.empty);\n    setError(event.error ? event.error.message : \"\");\n  };\n\nconst paymentIntent = async (e) => {\n  e.preventDefault();\n  \n  window\n      .fetch(\"https://productroles.herokuapp.com/create-payment-intent\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({items: [{ price: props.price }]})\n      })\n      .then(res => {\n        \n        return res.json();\n        \n      })\n      .then(data => {\n        console.log(\"payment intent created\"+data.clientSecret)\n        handleSubmit(data.clientSecret);\n      });\n}\n\n  const handleSubmit = async (clientSecret) => {\n    console.log(\"confirming payment\")\n    setProcessing(true);\n    const payload = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: elements.getElement(CardElement)\n      }\n    });\n    if (payload.error) {\n      setError(`Payment failed ${payload.error.message}`);\n      setProcessing(false);\n    } else {\n        \n      setError(null);\n      setProcessing(false);\n      setSucceeded(true);\n      handleForm();\n    }\n  };\n\n  const goHome = () => {\n    history.push(\"/\")\n  }\n  const handleForm = () => {\n      \n        props.form();\n  }\n  return (\n    <form id=\"payment-form\" onSubmit={paymentIntent}>\n      <CardElement id=\"card-element\" options={cardStyle} onChange={handleChange} />\n      <div className={succeeded ? \"p-4 row justified-content-center result-message hidden\" : \"p-4 row justified-content-center result-message\" }><button\n        disabled={processing || disabled || succeeded}\n        className=\"col btn btn-primary\"\n      >\n        <span id=\"button-text\">\n          {processing ? (\n            <div className=\"spinner\" id=\"spinner\"></div>\n          ) : (\n            \"Post Job Ad\"\n          )} ${props.price/1000}\n        </span>\n      </button></div>\n      {/* Show any error that happens when processing the payment */}\n      {error && (\n        <div className=\"card-error\" role=\"alert\">\n          {error}\n        </div>\n      )}\n      {/* Show a success message upon completion */}\n      <div className={succeeded ? \"p-4 justify-content-center result-message\" : \"p-4 justify-content-center result-message hidden\"}>\n        <div class=\"row\">\n          <button className=\"btn btn-primary\" onClick={goHome}>\n          Home.\n          </button>\n        </div>\n        <div class=\"row\">\n        <p>\n        Payment succeeded! View your new listing on the Home page!  An order summary will be emailed to you.\n        </p>\n        </div>\n      </div>\n      \n    </form>\n  );\n}\n\nexport default CheckoutForm"]},"metadata":{},"sourceType":"module"}